{% extends "baseAdmin.html.twig" %}

{% block title %}
    Calendar - PRYME
{% endblock %}

{% block stylesheets %}
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link rel="stylesheet" type="text/css" href="{{ asset('theme/plugins/fullcalendar/fullcalendar.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('theme/plugins/fullcalendar/custom-fullcalendar.advance.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('theme/plugins/flatpickr/flatpickr.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('theme/plugins/flatpickr/custom-flatpickr.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('theme/assets/css/forms/theme-checkbox-radio.css') }}"/>
    <link href="{{ asset('theme/assets/css/scrollspyNav.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('theme/plugins/bootstrap-select/bootstrap-select.min.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('theme/assets/css/forms/switches.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ asset('theme/assets/css/tables/table-basic.css') }}" rel="stylesheet" type="text/css">

    <!-- END PAGE LEVEL STYLES -->
    <style>
        .widget-content-area { border-radius: 6px;
            -webkit-box-shadow: 0 6px 10px 0 rgba(0,0,0,.14), 0 1px 18px 0 rgba(0,0,0,.12), 0 3px 5px -1px rgba(0,0,0,.2);
            -moz-box-shadow: 0 6px 10px 0 rgba(0,0,0,.14), 0 1px 18px 0 rgba(0,0,0,.12), 0 3px 5px -1px rgba(0,0,0,.2);
            box-shadow: 0 6px 10px 0 rgba(0,0,0,.14), 0 1px 18px 0 rgba(0,0,0,.12), 0 3px 5px -1px rgba(0,0,0,.2); margin-bottom: 10px; }
        .daterangepicker.dropdown-menu {
            z-index: 1059;
        }
    </style>
{% endblock %}

{% block body %}
<!-- BEGIN LOADER -->
<div id="load_screen"> <div class="loader"> <div class="loader-content">
            <div class="spinner-grow align-self-center"></div>
        </div></div></div>
<!--  END LOADER -->


{%  include "dashboard/header.html.twig" %}

<!--  BEGIN CONTENT AREA  -->
    <div class="main-container" id="container">

        <div class="overlay"></div>
        <div class="search-overlay"></div>

        {% include "dashboard/navbar.html.twig" %}


    <div id="content" class="main-content">
    <div class="layout-px-spacing">
        <div class="row layout-top-spacing" id="cancel-row">
            <div class="col-xl-12 col-lg-12 col-md-12">
                <div class="statbox widget box box-shadow">
                    <div class="widget-content widget-content-area">
                        <div class="calendar-upper-section">
                            <div class="row">
                                <div class="col-md-8 col-12">
                                    <div class="labels">
                                        <p class="label label-primary">{{ trainers[0].name }}</p>
                                        <p class="label label-warning">{{ trainers[1].name }}</p>
                                        <p class="label label-success">{{ trainers[2].name }}</p>
                                        <p class="label label-danger">{{ trainers[3].name }}</p>
                                    </div>
                                </div>
                                <div class="col-md-4 col-12">
                                    <form action="javascript:void(0);" class="form-horizontal mt-md-0 mt-3 text-md-right text-center">
                                        <button id="myBtn" class="btn btn-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar mr-2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg> Add Event</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div id="calendar"></div>
                    </div>
                </div>
            </div>

            <!-- The Modal -->
            <div id="addEventsModal" class="modal animated fadeIn">

                <div class="modal-dialog modal-dialog-centered">

                    <!-- Modal content -->
                    <div class="modal-content">

                        <div class="modal-body">

                            <span class="close">&times;</span>

                            <div class="add-edit-event-box">
                                <div class="add-edit-event-content">
                                    <h5 class="add-event-title modal-title">Add Events</h5>
                                    <h5 class="edit-event-title modal-title">Edit Events</h5>

                                    <form class="" id="eventModal">

                                        <div class="row" id="recursive-checkbox">
                                            <div class="col-md-6">
                                                <label for="start-date" class="">Recursive event:</label>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="switch s-icons s-outline s-outline-success mr-2">
                                                    <input type="checkbox" name="recursive" id="recursive">
                                                    <span class="slider round"></span>
                                                </label>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <label for="write-e" class="">Event Membership Group:</label>
                                                <div class="d-flex event-title">
                                                    <select id="write-e" name="name" class="selectpicker form-control mt-2 mb-2" data-live-search="true">
                                                        <option value="0">Select Membership Group</option>
                                                        {% for membershipsGroup in membershipsGroups %}
                                                            <option value="{{ membershipsGroup.name }}">{{ membershipsGroup.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                    <input type="hidden" name="eventId" id="eventId">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6 col-sm-6 col-12">
                                                <div class="form-group start-date">
                                                    <label for="start-date" class="">From:</label>
                                                    <div class="d-flex">
                                                        <input id="start-date" name="start-date" placeholder="Start Date" class="form-control" type="text">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-sm-6 col-12">
                                                <div class="form-group end-date">
                                                    <label for="end-date" class="">To:</label>
                                                    <div class="d-flex">
                                                        <input id="end-date" name="end-date" placeholder="End Date" type="text" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <label for="start-date" class="">Event Link:</label>
                                                <div class="d-flex event-title">
                                                    <input id="link" type="text" placeholder="Enter Link" class="form-control" name="link">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row" id="recursive-row" style="display: none">
                                            <div class="col-md-12">
                                                <div class="form-group end-date">
                                                    <label for="end-date" class="">Recursive until:</label>
                                                    <div class="d-flex">
                                                        <input id="recursive-end-date" name="recursive-end-date" placeholder="Recursive End Date" type="text" class="form-control">
                                                    </div>
                                                </div>
                                            </div>


                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="event-badge">
                                                    <p class="">Trainer:</p>

                                                    <div class="d-sm-flex d-block">
                                                        <div class="n-chk">
                                                            <label class="new-control new-radio radio-primary">
                                                                <input type="radio" class="new-control-input" name="trainer" value="{{ trainers[0].id }}">
                                                                <span class="new-control-indicator"></span>{{ trainers[0].name }}
                                                            </label>
                                                        </div>

                                                        <div class="n-chk">
                                                            <label class="new-control new-radio radio-warning">
                                                                <input type="radio" class="new-control-input" name="trainer" value="{{ trainers[1].id }}">
                                                                <span class="new-control-indicator"></span>{{ trainers[1].name }}
                                                            </label>
                                                        </div>

                                                        <div class="n-chk">
                                                            <label class="new-control new-radio radio-success">
                                                                <input type="radio" class="new-control-input" name="trainer" value="{{ trainers[2].id }}">
                                                                <span class="new-control-indicator"></span>{{ trainers[2].name }}
                                                            </label>
                                                        </div>

                                                        <div class="n-chk">
                                                            <label class="new-control new-radio radio-danger">
                                                                <input type="radio" class="new-control-input" name="trainer" value="{{ trainers[3].id }}">
                                                                <span class="new-control-indicator"></span>{{ trainers[3].name }}
                                                            </label>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="table-responsive" id="usersofevents">
                                                <table class="table table-bordered table-striped mb-4">
                                                    <thead>
                                                    <tr>
                                                        <th>Name</th>
                                                        <th class="text-center">Action</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                    </form>
                                </div>
                            </div>

                        </div>

                        <div class="modal-footer">
                            <button id="discard" class="btn" data-dismiss="modal">Discard</button>
                            <button id="add-e" class="btn" onclick="sendEvent()">Add Event</button>
                            <button id="edit-event" onclick="updateEvent()" class="btn">Save</button>
                            <button id="delete-event" onclick="deleteEvent()" class="btn">Delete</button>
                        </div>

                    </div>

                </div>

            </div>

        </div>

        </div>
        <div class="footer-wrapper">
            <div class="footer-section f-section-1">
                <p class="">Copyright © 2022 <a target="_blank" href="http://pryme.fit">Pryme</a>, All rights reserved.</p>
            </div>
        </div>
    </div>
    <!--  END CONTENT AREA  -->
</div>
<!-- END MAIN CONTAINER -->

    {% endblock %}


    {% block javascripts %}
        <!-- BEGIN PAGE LEVEL SCRIPTS -->
        <script>

            var eventsList = [
                {% for event in events %}
                {
                    id: '{{ event.id }}',
                    title: '{{ event.name }}',
                    link: '{{ event.link }}',
                    start: '{{ event.startdate | date('Y-m-d H:i') }}',
                    end: '{{ event.enddate | date('Y-m-d H:i') }}',
                    className:{% if event.trainer %}
                                    {% if event.trainer.name == 'Robert' %} "bg-warning", {% endif %}
                                    {% if event.trainer.name == 'Emilia' %} "bg-primary", {% endif %}
                                    {% if event.trainer.name == 'Flavia' %} "bg-success", {% endif %}
                                    {% if event.trainer.name == 'Vlad' %} "bg-danger", {% endif %}
                               {% else %}
                                    "bg-primary",
                               {% endif %}
                    description: {% if event.trainer %} '{{ event.trainer.name }}' {% else %} 'No trainer! ' {% endif %}
                },
                {% endfor %}
            ];


            var usersOfEvents = [];
            {% for k,users in usersofevents %}
                usersOfEvents[{{ k }}] = [];
                {% for u in users %}
                    usersOfEvents[{{ k }}].push('{{ u.firstname }}' + ' ' + '{{ u.lastname }}');
                {% endfor %}
            {% endfor %}

        </script>
        <script src="{{ asset('theme/plugins/fullcalendar/moment.min.js') }}"></script>
        <script src="{{ asset('theme/plugins/flatpickr/flatpickr.js') }}"></script>
        <script src="{{ asset('theme/plugins/fullcalendar/fullcalendar.min.js') }}"></script>
        <script src="{{ asset('theme/plugins/fullcalendar/custom-fullcalendar.advance.js') }}"></script>
        <script src="{{ asset('theme/assets/js/scrollspyNav.js') }}"></script>
        <script src="{{ asset('theme/plugins/bootstrap-select/bootstrap-select.min.js') }}"></script>
        <!-- END PAGE LEVEL SCRIPTS -->

        <script>
            function sendEvent(){
                let formData = $('#eventModal').serializeArray();

                if($("#start-date").val() && $("#end-date").val()) {
                    $.ajax({
                        url: '/createEvent/',
                        type: "POST",
                        data: objectifyForm(formData),
                        success: function (data) {
                            location.reload();
                        }
                    });
                }else{
                    alert("Please enter start date and end date");
                }
            }

            function updateEvent(){
                let formData = $('#eventModal').serializeArray();
                if($("#start-date").val() && $("#end-date").val()){
                    $.ajax({
                        url: '/updateEvent/' + $("#eventId").val(),
                        type: "POST",
                        data: objectifyForm(formData),
                        success: function (data) {
                            location.reload();
                        }
                    });
                }else{
                    alert("Please enter start date and end date");
                }
            }

            function deleteEvent(){
                $.ajax({
                    url: '/deleteEvent/' + $("#eventId").val(),
                    type: "GET",
                    success: function (data) {
                        location.reload();
                    }
                })
            }


            function objectifyForm(formArray) {
                let returnArray = {};
                for (let i = 0; i < formArray.length; i++){
                    returnArray[formArray[i]['name']] = formArray[i]['value'];
                }
                return returnArray;
            }

            $( document ).ready(function() {
                $('#recursive').change(function (){
                    if(this.checked){
                        $('#recursive-row').css('display', 'block');
                    }else{
                        $('#recursive-row').css('display', 'none');
                    }
                });
            });
        </script>
    {% endblock %}
